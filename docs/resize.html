<!DOCTYPE html>
<html><head>
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<style type="text/css">
		body { margin: 0; overflow: hidden; }
	</style>
</head><body>
	<div id="app">
		<component-test />
	</div>
	<script src="https://unpkg.com/vue@2.6.2/dist/vue.js"></script>
	<script type="text/javascript">
'use strict';

// ----------------------------------------------------------------
// ----------------------------------------------------------------
// ----------------------------------------------------------------

// コンポーネント
Vue.component('component-test', {
	data: function() {
		return {
			w: 100,
			h: 100,
			isResize: false,
			handleResizeTimerId: -1,
		};
	},

	computed: {
		hoge: function() {
			return false;
		}
	},
	
	methods: {
		handleResizeScheduler: function() {
			this.isResize = true;
			window.clearTimeout(this.handleResizeTimerId);
			this.handleResizeTimerId = window.setTimeout(() => {
				this.handleResize();
				this.isResize = false;
			}, 1000);
		},

		handleResize: function() {
			// 手元の端末だとinnerWidthは存在する要素の横幅につられて実際よりも大きな横幅になってしまうことがある
			// 横向きから縦向きに戻した際にinnerWidthだとおかしくなり、その場合はclientWidthを使う方が良さそうである
			// ただしclientWidthはアドレスバーの非表示を検知できず、アドレスバーが隠れると下に隙間ができる
			// そのため、横幅の絶対値はclientWidthが正しく、縦幅の比はinnerHeightが正しいものとして計算する
			this.w = window.innerWidth * (document.documentElement.clientWidth / window.innerWidth);
			this.h = window.innerHeight * (document.documentElement.clientWidth / window.innerWidth);
		},
	},

	mounted: function() {
		window.addEventListener('resize', this.handleResizeScheduler);
		this.handleResize();
	},

	beforeDestroy: function() {
		this.isResize = false;
		window.removeEventListener('resize', this.handleResizeScheduler);
	},

	template: `
		<div>
			<div :style="{
				position: 'relative',
				width: w + 'px',
				height: h + 'px',
				backgroundColor: 'red',
			}">
				あいうえおかき
			</div>
		</div>
	`,
});

// ----------------------------------------------------------------
// ----------------------------------------------------------------
// ----------------------------------------------------------------

// 処理はここから始まる
document.addEventListener('DOMContentLoaded', event => {
	const app = new Vue({ el: '#app', });
});

// ----------------------------------------------------------------
// ----------------------------------------------------------------
// ----------------------------------------------------------------
	</script>
</body></html>
