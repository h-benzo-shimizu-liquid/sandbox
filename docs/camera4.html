<!DOCTYPE html>
<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>camera</title>
	<style type="text/css">
		body { margin: 0; overflow: hidden; background-color: white; }
		#root { display: flex; flex-direction: column; justify-content: flex-start; align-items: center; }
		#root { position: absolute; left: 0; right: 0; top: 0; bottom: 0; padding: 20px; overflow: scroll; }
		#divVideo { width: 240px; height: 360px; background-color: black; }
		#divVideo video { width: 100%; height: 100%; }
		#divButton { display: flex; flex-direction: raw; justify-content: center; align-items: center; }
	</style>
</head><body>
	<div id="root">
		<div id="divVideo"></div>
		<div id="divButton">
			<textarea id="textareaConstraints" rows="6" cols="40"></textarea>
			<input id="inputButtonStart" type="button" value="start"></input>
			<input id="inputButtonApply" type="button" value="apply"></input>
			<input id="inputRangeFocus" type="range"></input>
		</div>
		<div id="console"></div>
		<div id="supported" style="background-color: silver;"></div>
	</div>
	<script type="text/javascript">
"use strict";

// ----------------------------------------------------------------
// ----------------------------------------------------------------
// ----------------------------------------------------------------

document.getElementById("textareaConstraints").value = `{
	"facingMode": "environment",
	"width": { "ideal": 3840 }
}`;

//"focusMode": "manual",
//"pointsOfInterest": { "x": 0, "y": 0 }

document.addEventListener("DOMContentLoaded", e => {
	document.getElementById("console").innerHTML = "push start button";

	document.getElementById("inputButtonStart").addEventListener("click", event => {
		document.getElementById("console").innerHTML = "wait";
		document.getElementById("supported").innerHTML = JSON.stringify(navigator.mediaDevices.getSupportedConstraints(), null, "  ").replaceAll("\n", "<br>");
		document.getElementById("divVideo").innerHTML = "";
		document.getElementById("divVideo").appendChild((() => {
			const element = document.createElement("video");
			element.autoplay = true;
			element.playsinline = true;
			navigator.mediaDevices.getUserMedia({
				video: JSON.parse(document.getElementById("textareaConstraints").value),
				audio: false,
			}).then(stream => {
				element.srcObject = stream;
				document.getElementById("console").innerHTML = `success ${element}`;
			}).catch(error => {
				document.getElementById("console").innerHTML = `failed ${error} ${error.message}`;
			});
			return element;
		})());
	});

	document.getElementById("inputButtonApply").addEventListener("click", event => {
		const stream = document.getElementById("divVideo").children[0].srcObject;
		const track = stream.getVideoTracks()[0];
		document.getElementById("supported").innerHTML = JSON.stringify(track.getCapabilities(), null, "  ").replaceAll("\n", "<br>");
	});

	document.getElementById("inputRangeFocus").addEventListener("click", event => {});
});

// ----------------------------------------------------------------
// ----------------------------------------------------------------
// ----------------------------------------------------------------
	</script>
</body></html>